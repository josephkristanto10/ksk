{
    "sourceFile": "process/mastercustomtemplate.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1636016547962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1636016572962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,9 +27,9 @@\n     \"\r\n );\r\n     \r\n     if(empty($search)) {\r\n-        $query_data = mysqli_query($conn, \"select * from template ORDER BY $order $dir LIMIT $start, $length\");\r\n+        $query_data = mysqli_query($conn, \"SELECT * FROM `folder_custom`  ORDER BY $order $dir LIMIT $start, $length\");\r\n     \r\n         $total_filtered = mysqli_query($conn, \"select * from template \");\r\n \r\n     } else {\r\n"
                }
            ],
            "date": 1636016547962,
            "name": "Commit-0",
            "content": "<?php\r\nrequire '../connection.php';\r\nsession_start();\r\n$myses = $_SESSION['idsister'];\r\n$mysesname = $_SESSION['namasister'];\r\n$tipe = $_POST['tipe'];\r\nif($tipe == \"load\")\r\n{\r\n\r\n    $where_like = [\r\n        'id',\r\n        'template',\r\n        'status'\r\n        \r\n    ];\r\n    \r\n    $response = $_REQUEST;\r\n    $start    = $response['start'];\r\n    $length   = $response['length'];\r\n    $order    = $where_like[$response['order'][0]['column']];\r\n    $dir      = $response['order'][0]['dir'];\r\n    $search   = $response['search']['value'];\r\n    $sessionidsister = $_SESSION['idsister'];\r\n    \r\n    $total_data = mysqli_query($conn, \r\n    \"select * from template\r\n    \"\r\n);\r\n    \r\n    if(empty($search)) {\r\n        $query_data = mysqli_query($conn, \"select * from template ORDER BY $order $dir LIMIT $start, $length\");\r\n    \r\n        $total_filtered = mysqli_query($conn, \"select * from template \");\r\n\r\n    } else {\r\n        $query_data = mysqli_query($conn, \"select * from template \r\n        where template.template LIKE '%$search%'  \r\n        ORDER BY $order $dir LIMIT $start, $length\");\r\n    \r\n        $total_filtered = mysqli_query($conn, \"select * from template \r\n        where template.template LIKE '%$search%'  \");\r\n    }\r\n    \r\n    $response['data'] = [];\r\n    \r\n    if($query_data) {\r\n        while($row = mysqli_fetch_assoc($query_data)) {\r\n            $mystats = \"\";\r\n            if($row['status'] == \"Active\")\r\n            {\r\n                $myactionsetto = \"InActive\";\r\n                $mystats = '<span class=\"badge badge-success\">Active</span>';\r\n                $myaction = \"<a class='dropdown-item' onclick = setstatus('\".$row['id'].\"-\".$myactionsetto.\"')><i class='icon-cross'></i>\r\n                Set InActive</a>'\";\r\n            }\r\n            else\r\n            {\r\n                $myactionsetto = \"Active\";\r\n                $mystats = '<span class=\"badge badge-danger\">InActive</span>';\r\n                $myaction = \"<a class='dropdown-item' onclick = setstatus('\".$row['id'].\"-\".$myactionsetto.\"')><i class='icon-check'></i>\r\n                Set Active</a>'\";\r\n            }\r\n            \r\n            $response['data'][] = [\r\n           \r\n                \"<label id ='idtemplate\".$row['id'].\"'>\".$row['id'].\"</label>\",\r\n                \"<label id ='template\".$row['id'].\"'>\".$row['template'].\"</label>\",\r\n                \"<label id ='status\".$row['id'].\"'>\".$mystats.\"</label>\",\r\n                ' <div class=\"list-icons\">\r\n                <div class=\"dropdown\">\r\n                    <a href=\"#\" class=\"list-icons-item\" data-toggle=\"dropdown\">\r\n                        <i class=\"icon-menu9\"></i>\r\n                    </a>\r\n    \r\n                    <div class=\"dropdown-menu dropdown-menu-right\">\r\n                        <a href=\"#myModaledit\" data-toggle=\"modal\" class=\"dropdown-item\" id =\"click-'.$row['id'].'\"  onclick = \"openmodaledit(this)\"><i class=\"icon-pen\"></i>\r\n                            Edit</a>\r\n                            <a  class=\"dropdown-item\" id =\"delete-'.$row['id'].'\"  onclick = \"deleterow(this)\"><i class=\"icon-trash\"></i>\r\n                            Delete</a>\r\n                        '.$myaction.'\r\n                   \r\n                    </div>\r\n                </div>\r\n            </div>'\r\n            ];\r\n        }\r\n    }\r\n    \r\n    $response['recordsTotal'] = 0;\r\n    if($total_data <> FALSE) {\r\n        $response['recordsTotal'] = mysqli_num_rows($total_data);\r\n    }\r\n    \r\n    $response['recordsFiltered'] = 0;\r\n    if($total_filtered <> FALSE) {\r\n        $response['recordsFiltered'] = mysqli_num_rows($total_filtered);\r\n    }  \r\n    \r\n    echo json_encode($response);\r\n}\r\nelse if($tipe == \"add\"){\r\n\r\n    $sessionuser = \"1\";\r\n    $mytemplate = $_POST['mytemplate'];\r\n    $myselected = array();\r\n    \r\n    if(isset($_POST['myselected']))\r\n    {\r\n        $myselected = $_POST['myselected'];\r\n    }\r\n    // echo $mytemplate.\"----\".$myselected;\r\n    $sql = \"INSERT into template values(NULL,'\".$mytemplate.\"', 'Active', '\".$sessionuser.\"', CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)\";\r\n    $res = $conn->query($sql);\r\n    if(($conn -> affected_rows)>0)\r\n    {\r\n    \r\n        $idinsert = $conn->insert_id;\r\n        if(isset($_POST['myselected']))\r\n        {\r\n            for($i = 0; $i<count($myselected);$i++)\r\n            {\r\n                $sql = \"INSERT into custom_to_template values(NULL,'\".$idinsert.\"','\".$myselected[$i].\"')\";\r\n                $ress = $conn->query($sql);\r\n                // echo $sql;\r\n            }\r\n        }\r\n      \r\n        echo \"sukses\";\r\n    }\r\n    else{\r\n        echo \"tidak\";\r\n    }\r\n    // echo $sql;\r\n}\r\n\r\nelse if($tipe == \"changedata\")\r\n{\t\t\r\n    $id  = $_POST['myid'];\r\n    $mycode = $_POST['mycode'];\r\n    $mybranch = $_POST['mybranch'];\r\n    $mybuilding = $_POST['mybuilding'];\r\n    $myfloor = $_POST['myfloor'];\r\n    $myrooms = $_POST['myrooms'];\r\n    $myrackname = $_POST['myrackname'];\r\n    $description = $_POST['mydescription'];\r\n    $sql = \"update rack set \r\n    idsistercompany = '\".$myses.\"', \r\n    idbranch = '\".$mybranch.\"', \r\n    idbuilding = '\".$mybuilding.\"', \r\n    idfloor = '\".$myfloor.\"', \r\n    idroom = '\".$myrooms.\"', \r\n    rackname = '\".$myrackname.\"', \r\n    description = '\".$description.\"'\r\n    where id = '\".$id.\"'\";\r\n    $res = $conn->query($sql);\r\n    if(($conn -> affected_rows)>0)\r\n    {\r\n        echo \"sukses\";\r\n    }\r\n    else{\r\n        echo \"tidak\";\r\n    }\r\n    // echo $sql;\r\n}\r\nelse if($tipe == \"setstatus\")\r\n{\r\n    $myid = $_POST['myidchange'];\r\n    $stat = $_POST['stat'];\r\n    $sql = \"update rack set status = '\".$stat.\"' where id = '\".$myid.\"'\";\r\n    $res = $conn->query($sql);\r\n}\r\nelse if($tipe == \"getbranch\")\r\n{\r\n    \r\n    $sql = 'SELECT lbranch.idbranch, lbranch.branch FROM `location_setup_sister_branch`\r\n            inner join location_branch lbranch on lbranch.idbranch = location_setup_sister_branch.idbranch where location_setup_sister_branch.idsistercompany = '.$myses;\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['idbranch'].\"' >\".$r['branch'].\"</option>\";\r\n        }\r\n        echo $mystring.\"|\".$mysesname;\r\n    }\r\n    else{\r\n        echo \"none\".\"|\".$mysesname;\r\n    }\r\n}\r\nelse if($tipe == \"getbuilding\")\r\n{\r\n    $myid = $_POST['idbranch'];\r\n    $sql = \"SELECT id, buildingname FROM `location_building` inner join location_setup_sister_branch lssb on lssb.idsetupsisterbranch = location_building.idsetupsisterbranch where lssb.idbranch = '\".$myid.\"' and lssb.idsistercompany = \".$myses;\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['id'].\"' >\".$r['buildingname'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\nelse if($tipe == \"getfloor\")\r\n{\r\n    $mybranchid = $_POST['idbranch'];\r\n    $myid = $_POST['idbuilding'];\r\n    $sql = \"SELECT lfloor.floor, lfloor.id FROM location_setup_building_floor lsbf inner join location_floor lfloor on lfloor.id = lsbf.idfloor where lsbf.idbuilding = '$myid'\";\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['id'].\"' >\".$r['floor'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\nelse if($tipe == \"getroom\"){\r\n    $mybranchid = $_POST['idbranch'];\r\n    $myidbuilding = $_POST['idbuilding'];\r\n    $myfloor = $_POST['idfloor'];\r\n    $sql = \"SELECT lroom.id, lroom.room FROM location_room lroom\r\n    inner join location_setup_building_floor lsbf on lsbf.idlocationsetupbuildingfloor = lroom.idsetupbuildingfloor\r\n    where lsbf.idbuilding  = '$myidbuilding' and lsbf.idfloor = '$myfloor'\";\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['id'].\"' >\".$r['room'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\nelse if($tipe == \"getprovince\")\r\n{\r\n    $getid = $_POST['idcountry'];\r\n    $sql = \"select * from province where province.idcountry = '\".$getid.\"' and province.status = 'Active'\";\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['id'].\"' >\".$r['name'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\nelse if($tipe == \"getcity\")\r\n{\r\n    $getid = $_POST['idprovince'];\r\n    $sql = \"select * from city where city.idprovince = '\".$getid.\"' and city.status = 'Active'\";\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['id'].\"' >\".$r['name'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\nelse if($tipe == \"getdepartment\")\r\n{\r\n    $getid = $_POST['iddivisi'];\r\n    $sql = \"select *, department.id as iddepartment from department inner join divisi on divisi.id = department.iddivisi  where divisi.id = '\".$getid.\"' and department.status = 'Active'\";\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['iddepartment'].\"' >\".$r['department'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\n?>"
        }
    ]
}