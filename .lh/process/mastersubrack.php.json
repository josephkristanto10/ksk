{
    "sourceFile": "process/mastersubrack.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1630984031802,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1630984031802,
            "name": "Commit-0",
            "content": "<?php\r\nrequire '../connection.php';\r\nsession_start();\r\n$myses = $_SESSION['idsister'];\r\n$mysesname = $_SESSION['namasister'];\r\n$tipe = $_POST['tipe'];\r\nif($tipe == \"load\")\r\n{\r\n\r\n    $where_like = [\r\n        'company',\r\n        'description',\r\n        'address',\r\n        'countryname',\r\n        'provincename',\r\n        'cityname',\r\n        'officetelp',\r\n        'department',\r\n        'rank',\r\n        'contactname',\r\n        'remark',\r\n        'status'\r\n        \r\n    ];\r\n    \r\n    $response = $_REQUEST;\r\n    $start    = $response['start'];\r\n    $length   = $response['length'];\r\n    $order    = $where_like[$response['order'][0]['column']];\r\n    $dir      = $response['order'][0]['dir'];\r\n    $search   = $response['search']['value'];\r\n    \r\n    $total_data = mysqli_query($conn, \r\n    \"select s.*, department.department, rank.rank, country.name as countryname, province.name as provincename, city.name as cityname  from supplier s \r\n    inner join country on country.id = s.idcountry\r\n    inner join province on province.id = s.idprovince\r\n    inner join city on city.id = s.idcity\r\n    inner join rank on rank.id = s.idrank\r\n    inner join department on department.id = s.iddepartment\r\n    \"\r\n);\r\n    \r\n    if(empty($search)) {\r\n        $query_data = mysqli_query($conn, \"select s.*, department.department, rank.rank, country.name as countryname, province.name as provincename, city.name as cityname  from supplier s \r\n        inner join country on country.id = s.idcountry\r\n        inner join province on province.id = s.idprovince\r\n        inner join city on city.id = s.idcity\r\n        inner join rank on rank.id = s.idrank\r\n        inner join department on department.id = s.iddepartment ORDER BY $order $dir LIMIT $start, $length\");\r\n    \r\n        $total_filtered = mysqli_query($conn, \"select s.*, department.department, rank.rank, country.name as countryname, province.name as provincename, city.name as cityname  from supplier s \r\n        inner join country on country.id = s.idcountry\r\n        inner join province on province.id = s.idprovince\r\n        inner join city on city.id = s.idcity\r\n        inner join rank on rank.id = s.idrank\r\n        inner join department on department.id = s.iddepartment\");\r\n\r\n    } else {\r\n        $query_data = mysqli_query($conn, \"select s.*, department.department, rank.rank, country.name as countryname, province.name as provincename, city.name as cityname  from supplier s \r\n        inner join country on country.id = s.idcountry\r\n        inner join province on province.id = s.idprovince\r\n        inner join city on city.id = s.idcity\r\n        inner join rank on rank.id = s.idrank\r\n        inner join department on department.id = s.iddepartment \r\n        WHERE s.company LIKE '%$search%' \r\n        OR s.description LIKE '%$search%'\r\n        OR s.address LIKE '%$search%'\r\n        OR country.name LIKE '%$search%'\r\n        OR province.name LIKE '%$search%'\r\n        OR city.name LIKE '%$search%'\r\n        OR s.officetelp LIKE '%$search%'\r\n        OR s.contactname LIKE '%$search%'\r\n        OR s.remark LIKE '%$search%'\r\n        OR s.status LIKE '%$search%'\r\n        OR department.department LIKE '%$search%'\r\n        OR rank.rank LIKE '%$search%'\r\n        ORDER BY $order $dir LIMIT $start, $length\");\r\n    \r\n        $total_filtered = mysqli_query($conn, \"select s.*, department.department, rank.rank, country.name as countryname, province.name as provincename, city.name as cityname  from supplier s \r\n        inner join country on country.id = s.idcountry\r\n        inner join province on province.id = s.idprovince\r\n        inner join city on city.id = s.idcity\r\n        inner join rank on rank.id = s.idrank\r\n        inner join department on department.id = s.iddepartment \r\n        WHERE s.company LIKE '%$search%' \r\n        OR s.description LIKE '%$search%'\r\n        OR s.address LIKE '%$search%'\r\n        OR country.name LIKE '%$search%'\r\n        OR province.name LIKE '%$search%'\r\n        OR city.name LIKE '%$search%'\r\n        OR s.officetelp LIKE '%$search%'\r\n        OR s.contactname LIKE '%$search%'\r\n        OR s.remark LIKE '%$search%'\r\n        OR department.department LIKE '%$search%'\r\n        OR rank.rank LIKE '%$search%'\r\n        OR s.status LIKE '%$search%'\");\r\n    }\r\n    \r\n    $response['data'] = [];\r\n    \r\n    if($query_data) {\r\n        while($row = mysqli_fetch_assoc($query_data)) {\r\n            $mystats = \"\";\r\n            if($row['status'] == \"Active\")\r\n            {\r\n                $myactionsetto = \"InActive\";\r\n                $mystats = '<span class=\"badge badge-success\">Active</span>';\r\n                $myaction = \"<a class='dropdown-item' onclick = setstatus('\".$row['id'].\"-\".$myactionsetto.\"')><i class='icon-check'></i>\r\n                Set InActive</a>'\";\r\n            }\r\n            else\r\n            {\r\n                $myactionsetto = \"Active\";\r\n                $mystats = '<span class=\"badge badge-danger\">InActive</span>';\r\n                $myaction = \"<a class='dropdown-item' onclick = setstatus('\".$row['id'].\"-\".$myactionsetto.\"')><i class='icon-check'></i>\r\n                Set Active</a>'\";\r\n            }\r\n   \r\n            $response['data'][] = [\r\n                \"<label id ='Company\".$row['id'].\"'>\".$row['company'].\"</label>\",\r\n                \"<label id ='Description\".$row['id'].\"'>\".$row['description'].\"</label>\",\r\n                \"<label id ='Address\".$row['id'].\"'>\".$row['address'].\"</label>\",\r\n                \"<label id ='Country\".$row['id'].\"'>\".$row['countryname'].\"</label>\",\r\n                \"<label id ='Province\".$row['id'].\"'>\".$row['provincename'].\"</label>\",\r\n                \"<label id ='City\".$row['id'].\"'>\".$row['cityname'].\"</label>\",\r\n                \"<label id ='Phone\".$row['id'].\"'>\".$row['officetelp'].\"</label>\",\r\n                \"<label id ='Contactname\".$row['id'].\"'>\".$row['contactname'].\"</label>\",\r\n                \"<label id ='Remark\".$row['id'].\"'>\".$row['remark'].\"</label>\",\r\n                \"<label id ='status\".$row['id'].\"'>\".$mystats.\"</label>\",\r\n                ' <div class=\"list-icons\">\r\n                <div class=\"dropdown\">\r\n                    <a href=\"#\" class=\"list-icons-item\" data-toggle=\"dropdown\">\r\n                        <i class=\"icon-menu9\"></i>\r\n                    </a>\r\n    \r\n                    <div class=\"dropdown-menu dropdown-menu-right\">\r\n                    <a href=\"#myModalshow\" data-toggle=\"modal\" class=\"dropdown-item\" id =\"show|'.$row['hp1'].'|'.$row['hp2'].'|'.$row['email1'].'|'.$row['email2'].'|'.$row['company'].'|'.$row['rank'].'|'.$row['department'].'|'.$row['contactname'].'\"  onclick = \"opendetail(this)\"><i class=\"icon-check\"></i>\r\n                            Show Detail</a>   \r\n                    <a href=\"#myModaledit\" data-toggle=\"modal\" class=\"dropdown-item\" id =\"click-'.$row['id'].'-'.$row['idcountry'].'-'.$row['idprovince'].'-'.$row['idcity'].'-'.$row['idrank'].'-'.$row['iddepartment'].'-'.$row['hp1'].'-'.$row['hp2'].'-'.$row['email1'].'-'.$row['email2'].'\"  onclick = \"openmodaledit(this)\"><i class=\"icon-check\"></i>\r\n                            Edit</a>\r\n                        \r\n                        '.$myaction.'\r\n                   \r\n                    </div>\r\n                </div>\r\n            </div>'\r\n            ];\r\n        }\r\n    }\r\n    \r\n    $response['recordsTotal'] = 0;\r\n    if($total_data <> FALSE) {\r\n        $response['recordsTotal'] = mysqli_num_rows($total_data);\r\n    }\r\n    \r\n    $response['recordsFiltered'] = 0;\r\n    if($total_filtered <> FALSE) {\r\n        $response['recordsFiltered'] = mysqli_num_rows($total_filtered);\r\n    }  \r\n    \r\n    echo json_encode($response);\r\n}\r\nelse if($tipe == \"add\"){\r\n\r\n    $mycompany  = $_POST['mycompany'];\r\n    $mydescription = $_POST['mydescription'];\r\n    $myaddress = $_POST['myaddress'];\r\n    $mycountry = $_POST['mycountry'];\r\n    $myprovince = $_POST['myprovince'];\r\n    $mycity = $_POST['mycity'];\r\n    $myrank = $_POST['myrank'];\r\n    $mydepartment = $_POST['mydepartment'];\r\n    $myphone = $_POST['myphone'];\r\n    $mycontactname = $_POST['mycontactname'];\r\n    $myhp1 = $_POST['myhp1'];\r\n    $myhp2 = $_POST['myhp2'];\r\n    $myemail1 = $_POST['myemail1'];\r\n    $myemail2 = $_POST['myemail2'];\r\n    $myremark = $_POST['myremark'];\r\n\r\n    \r\n    $sql = \"INSERT into supplier values(NULL,'\".$mycompany.\"', '\".$mydescription.\"' , '\".$myaddress.\"' ,'\".$mycountry.\"' ,'\".\r\n    $myprovince.\"', '\".$mycity.\"' ,'\".$myrank.\"' , '\".$mydepartment.\"' , '\".$myphone.\"' , '\".$mycontactname.\"' , '\".$myhp1.\"' , '\".\r\n    $myhp2.\"' , '\".$myemail1.\"' , '\".$myemail2.\"' , '\".$myremark.\"', 'Active')\";\r\n    $res = $conn->query($sql);\r\n    if(($conn -> affected_rows)>0)\r\n    {\r\n        echo \"sukses\";\r\n    }\r\n    else{\r\n        echo \"tidak\";\r\n    }\r\n    // echo $sql;\r\n}\r\nelse if($tipe == \"changedata\")\r\n{\t\t\r\n    $id  = $_POST['myid'];\r\n    $mydescription = $_POST['mydescription'];\r\n    $myaddress = $_POST['myaddress'];\r\n    $mycountry = $_POST['mycountry'];\r\n    $myprovince = $_POST['myprovince'];\r\n    $mycity = $_POST['mycity'];\r\n    $myrank = $_POST['myrank'];\r\n    $mydepartment = $_POST['mydepartment'];\r\n    $myphone = $_POST['myphone'];\r\n    $mycontactname = $_POST['mycontactname'];\r\n    $myhp1 = $_POST['myhp1'];\r\n    $myhp2 = $_POST['myhp2'];\r\n    $myemail1 = $_POST['myemail1'];\r\n    $myemail2 = $_POST['myemail2'];\r\n    $myremark = $_POST['myremark'];\r\n    $sql = \"update supplier set \r\n    description = '\".$mydescription.\"', \r\n    address = '\".$myaddress.\"', \r\n    idcountry = '\".$mycountry.\"', \r\n    idprovince = '\".$myprovince.\"', \r\n    idcity = '\".$mycity.\"', \r\n    idrank = '\".$myrank.\"', \r\n    iddepartment = '\".$mydepartment.\"', \r\n    officetelp = '\".$myphone.\"', \r\n    contactname = '\".$mycontactname.\"', \r\n    hp1 = '\".$myhp1.\"', \r\n    hp2 = '\".$myhp2.\"', \r\n    email1 = '\".$myemail1.\"', \r\n    email2 = '\".$myemail2.\"', \r\n    remark = '\".$myremark.\"' \r\n    where id = '\".$id.\"'\";\r\n    $res = $conn->query($sql);\r\n    if(($conn -> affected_rows)>0)\r\n    {\r\n        echo \"sukses\";\r\n    }\r\n    else{\r\n        echo \"tidak\";\r\n    }\r\n    // echo $sql;\r\n}\r\nelse if($tipe == \"setstatus\")\r\n{\r\n    $myid = $_POST['myidchange'];\r\n    $stat = $_POST['stat'];\r\n    $sql = \"update supplier set status = '\".$stat.\"' where id = '\".$myid.\"'\";\r\n    $res = $conn->query($sql);\r\n}\r\nelse if($tipe == \"getbranch\")\r\n{\r\n    \r\n    $sql = 'SELECT lbranch.idbranch, lbranch.branch FROM `location_setup_sister_branch`\r\n            inner join location_branch lbranch on lbranch.idbranch = location_setup_sister_branch.idbranch where location_setup_sister_branch.idsistercompany = '.$myses;\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['idbranch'].\"' >\".$r['branch'].\"</option>\";\r\n        }\r\n        echo $mystring.\"|\".$mysesname;\r\n    }\r\n    else{\r\n        echo \"none\".\"|\".$mysesname;\r\n    }\r\n}\r\nelse if($tipe == \"getbuilding\")\r\n{\r\n    $myid = $_POST['idbranch'];\r\n    $sql = \"SELECT id, buildingname FROM `location_building` inner join location_setup_sister_branch lssb on lssb.idsetupsisterbranch = location_building.idsetupsisterbranch where lssb.idbranch = '\".$myid.\"' and lssb.idsistercompany = \".$myses;\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['id'].\"' >\".$r['buildingname'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\nelse if($tipe == \"getfloor\")\r\n{\r\n    $mybranchid = $_POST['idbranch'];\r\n    $myid = $_POST['idbuilding'];\r\n    $sql = \"SELECT location_floor.id, location_floor.floor FROM `location_setup_building_floor` inner join location_setup_sister_branch on location_setup_sister_branch.idsetupsisterbranch = location_setup_building_floor.idsetupsisterbranch inner join location_floor on location_floor.id = location_setup_building_floor.idfloor where location_setup_building_floor.idbuilding = '\".$myid.\"' and location_setup_sister_branch.idbranch = '\".$mybranchid.\"' and location_setup_sister_branch.idsistercompany = \".$myses;\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['id'].\"' >\".$r['floor'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\nelse if($tipe == \"getroom\"){\r\n    $mybranchid = $_POST['idbranch'];\r\n    $myidbuilding = $_POST['idbuilding'];\r\n    $myfloor = $_POST['idfloor'];\r\n    $sql = \"SELECT location_room.id , location_room.room FROM location_room inner join location_setup_sister_branch lssb on lssb.idsetupsisterbranch = location_room.idsetupsisterbranch inner join location_building lbuilding on lbuilding.id = location_room.idbuilding inner join location_floor lfloor on lfloor.id = location_room.idfloor inner join location_sister_company lsc on lsc.id = lssb.idsistercompany inner join location_branch on location_branch.idbranch = lssb.idbranch where location_room.idfloor = '\".$myfloor.\"' and location_room.idbuilding = '\".$myidbuilding.\"' and lssb.idsistercompany = '\".$myses.\"' and lssb.idbranch = '\".$mybranchid.\"'\";\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['id'].\"' >\".$r['room'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\nelse if($tipe == \"getprovince\")\r\n{\r\n    $getid = $_POST['idcountry'];\r\n    $sql = \"select * from province where province.idcountry = '\".$getid.\"' and province.status = 'Active'\";\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['id'].\"' >\".$r['name'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\nelse if($tipe == \"getcity\")\r\n{\r\n    $getid = $_POST['idprovince'];\r\n    $sql = \"select * from city where city.idprovince = '\".$getid.\"' and city.status = 'Active'\";\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['id'].\"' >\".$r['name'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\nelse if($tipe == \"getdepartment\")\r\n{\r\n    $getid = $_POST['iddivisi'];\r\n    $sql = \"select *, department.id as iddepartment from department inner join divisi on divisi.id = department.iddivisi  where divisi.id = '\".$getid.\"' and department.status = 'Active'\";\r\n    $res = $conn->query($sql);\r\n    $mystring = \"\";\r\n    if($res -> num_rows>0)\r\n    {\r\n        while($r = mysqli_fetch_array($res))\r\n        {\r\n            $mystring .= \"<option value = '\".$r['iddepartment'].\"' >\".$r['department'].\"</option>\";\r\n        }\r\n        echo $mystring;\r\n    }\r\n    else{\r\n        echo \"none\";\r\n    }\r\n}\r\n?>"
        }
    ]
}